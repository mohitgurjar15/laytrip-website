<form [formGroup]="travelerForm" (ngSubmit)="submit(travelerForm.value)">
  <ng-container *ngFor="let travelerItem of travelers | keyvalue; let y = index;">
    <div *ngIf="travelerItem.value.adults.length>0 && cartNumber==y" [formGroupName]="travelerItem.key">
      <div formArrayName="adults">
        <div id="accordion" class="accordion_bookings">
          <div class="card" *ngFor="let traveler of travelerForm.get('type'+y+'.adults')['controls']; let x = index;">
            <div class="card-header custom_header" (click)="selectTravelerNumber($event,cartNumber,x)">
              <a class="card-link" data-toggle="collapse" [href]="'#adult_collapse'+y+x" aria-expanded="true">
                <svg xmlns="http://www.w3.org/2000/svg" width="29" height="29" viewBox="0 0 29 29">
                  <defs></defs>
                  <path class="a"
                    d="M24.753,4.247A14.5,14.5,0,0,0,4.247,24.753,14.5,14.5,0,0,0,24.753,4.247ZM7.269,25.057a7.342,7.342,0,0,1,14.462,0,12.773,12.773,0,0,1-14.462,0ZM9.89,12.68a4.61,4.61,0,1,1,4.61,4.61A4.616,4.616,0,0,1,9.89,12.68ZM23.2,23.878a9.056,9.056,0,0,0-5.264-5.91,6.31,6.31,0,1,0-6.876,0A9.054,9.054,0,0,0,5.8,23.878a12.8,12.8,0,1,1,17.405,0Zm0,0" />
                </svg>
                <span class="tr_type">
                  {{x==0?'Primary Traveler':travlerLabels['en'][traveler.controls.type.value]}}
                </span>
                <!-- <span class="tr_type mob_names {{travelerItem.value.adults[x].userId}}" [ngClass]="{'hide_section':travelerItem.value.adults[x].userId==''}">
                  {{x==0?'Primary Traveler':travlerLabels['en'][traveler.controls.type.value]}}
                </span> -->
                

                <span class="trv_name hide_section">
                  {{travelerItem.value.adults[x].userId?travelerItem.value.adults[x].first_name + ' '
                  +travelerItem.value.adults[x].last_name:'' | titlecase}}
                </span>
              </a>
              <a *ngIf="isTravller" class="dropdown-toggle traveler_drop_down"
                data-toggle="dropdown" aria-expanded="false">{{travelerItem.value.adults[x].userId?travelerItem.value.adults[x].first_name + '
                '
                +travelerItem.value.adults[x].last_name:'Saved Travelers' | titlecase}}</a>
              <ul *ngIf="isTravller" class="dropdown-menu options_name">
                <ng-container *ngFor="let user of myTravelers">
                  <li (click)='selectTraveler(user.userId,x)'
                    *ngIf="user.user_type==traveler.controls.type.value && traveler.roleId!=7">
                    {{user.firstName}} {{user.lastName}}</li>
                </ng-container>
              </ul>

              <!-- <select class="form-control traveler_drop_down" (change)='selectTraveler($event,x)'>
                <option [selected]>Saved Travelers </option>
                <ng-container *ngFor="let user of myTravelers">
                  <option [selected]="travelerItem.value.adults[x].userId===user.userId" [value]="user.userId">
                    {{user.firstName}} {{user.lastName}}</option>
                </ng-container>
              </select> -->
            </div>
            <div [id]="'adult_collapse'+y+x" class="collapse show" data-parent="#accordion">
              <div class="card-body">
                <!-- <div class="sub_cat_wrapper">
                  <button (click)="selectTravelerType('adult',x)" class="add_btn_lined"
                    [ngClass]="{'active' : traveler.controls.type.value=='adult'}">Add Adult (Over 12)
                  </button>
                  <button *ngIf="travelerItem.value.child>0" (click)="selectTravelerType('child',x)"
                    class="add_btn_lined" [ngClass]="{'active' : traveler.controls.type.value=='child'}">Add Child
                    (2-12)
                  </button>
                  <button *ngIf="travelerItem.value.infant>0" (click)="selectTravelerType('infant',x)"
                    class="add_btn_lined" [ngClass]="{'active' : traveler.controls.type.value=='infant'}">Add Infant
                    (Under 12)
                  </button>
                </div> -->
                <!-- <app-my-traveler travelerId={{travelerItem.value.adults[x].userId}}
                  traveler_type={{traveler.controls.type.value}} traveler_number={{x}}></app-my-traveler> -->

                <div [formGroupName]="x" class="common_form">
                  <div class="form-row">
                    <div class="col-sm-12 col-md-4 mb-sm-10 mandetory_wrps">
                      <label for="">First Name*</label>
                      <input type="text" class="form-control" formControlName="first_name" tabindex={{x}}
                        (keypress)="commonFunction.preventNumberInput($event)">
                      <div *ngIf="traveler.controls.first_name.touched && traveler.controls.first_name.errors"
                        class="error">
                        <small *ngIf="traveler.controls.first_name.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">
                          Please enter your first name.
                        </small>
                        <small *ngIf="traveler.controls.first_name.errors.pattern" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">
                          {{'first_name_string_validation' | translate}} </small>
                      </div>
                    </div>
                    <div class="col-sm-12 col-md-4 mb-sm-10 mandetory_wrps">
                      <label for="">Last Name*</label>
                      <input type="text" class="form-control" formControlName="last_name" tabindex={{x}}
                        (keypress)="commonFunction.preventNumberInput($event)">
                      <div *ngIf="traveler.controls.last_name.touched && traveler.controls.last_name.errors"
                        class="error">
                        <small *ngIf="traveler.controls.last_name.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">Please
                          enter your last name.</small>
                        <small *ngIf="traveler.controls.last_name.errors.pattern" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">
                          {{'last_name_string_validation' | translate}} </small>
                      </div>
                    </div>
                    <div class="col-sm-12 col-md-4 mb-sm-10 mandetory_wrps drop_down_mandetory">
                      <!-- <label for="">Gender*</label>
                      <select class="form-control" formControlName="gender" tabindex={{x}}>
                        <option value="M">Male</option>
                        <option value="F">Female</option>
                        <option value="O">Other</option>
                      </select> -->
                      <div class="gender_anchers gender_selection">
                      <label for="">Gender*</label>
                      <ng-select formControlName="gender" [clearable]="false" placeholder="Select Gender">
                        <ng-option value="M">Male</ng-option>
                        <ng-option value="F">Female</ng-option>
                        <ng-option value="O">Other</ng-option> 
                    </ng-select>
                      <div *ngIf="traveler.controls.gender.touched && traveler.controls.gender.errors" class="error">
                        <small *ngIf="traveler.controls.gender.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">Please
                          select your gender.</small>
                      </div>
                    </div>
                    </div>
                    <div class="col-sm-12 col-md-4 mb-sm-10 mandetory_wrps"
                      *ngIf="traveler.controls.type.value=='' || traveler.controls.type.value=='adult'">
                      <label for="">Email*</label>
                      <input type="email" class="form-control" formControlName="email" tabindex={{x}}>
                      <div *ngIf="traveler.controls.email.touched && traveler.controls.email.errors" class="error">
                        <small *ngIf="traveler.controls.email.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">Please
                          enter your email address.</small>
                        <small *ngIf="traveler.controls.email.errors.pattern" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">Please
                          enter valid email address.</small>
                      </div>
                      <div *ngIf="traveler.controls.is_duplictae_email.value==true" class="error">
                        <small *ngIf="traveler.controls.email.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error"
                            class="error_img">Traveler with this email already exists.</small>
                      </div>
                    </div>
                    <div class="col-sm-12 col-md-4 mb-sm-10 telephone_wrps mandetory_wrps"
                      *ngIf="traveler.controls.type.value=='' || traveler.controls.type.value=='adult'">
                      <label for="">{{ 'phone_no' | translate}}*</label>
                      <span class="tel_span"
                        [ngClass]="{'red_underline':traveler.controls.phone_no.touched && traveler.controls.phone_no.errors}">
                        <!-- <input type="text" class="form-control" maxlength="6"
                          formControlName="country_code"> -->
                        <ng-select class="ng-customClass country_code" [items]="countries" bindLabel="phonecode"
                          [tabIndex]="x" bindValue="phonecode" formControlName="country_code" [clearable]="false">
                        </ng-select>
                        <input type="text" mask="(000) 000-0000" class="form-control" maxlength="14"
                          formControlName="phone_no" tabindex={{x}}>
                      </span>
                      <div *ngIf="traveler.controls.phone_no.touched && traveler.controls.phone_no.errors"
                        class="error">
                        <small *ngIf="traveler.controls.phone_no.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">
                          Please enter your phone number.</small>
                        <small *ngIf="traveler.controls.phone_no.errors.minlength" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error"
                            class="error_img">Minimum 10 characters.</small>
                      </div>
                    </div>
                    <div class="col-sm-12 dobs col-md-4 mb-sm-10 dobs_account mandetory_wrps">
                      <label for="">{{'dob' | translate}}*</label>
                      <!-- <input onkeydown="return false" type="text" class="form-control" bsDatepicker tabindex={{x}}
                        formControlName="dob" [bsConfig]="bsConfig" [minDate]="traveler.controls.dobMinDate.value"
                        [maxDate]="traveler.controls.dobMaxDate.value"> -->
                      <input #dobText placeholder="MM/DD/YYYY" type="text" class="form-control" tabindex={{x}}
                        [textMask]="dateYeaMask" formControlName="dob"
                        (change)="checkMaximumMinimum($event, dobText.value, cartNumber, x)">
                      <div *ngIf="traveler.controls.dob.touched && traveler.controls.dob.errors" class="error">
                        <small *ngIf="traveler.controls.dob.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">
                          Please enter valid date of Birth.</small>
                        <small *ngIf="traveler.controls.dob.errors.pattern" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">Please
                          enter valid date of Birth.</small>
                      </div>
                      <div *ngIf="!traveler.controls.is_valid_date.value" class="error">
                        <small class="error_field" *ngIf="traveler.controls.type.value === 'adult'">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">Adult
                          is age 12+.</small>
                        <small class="error_field" *ngIf="traveler.controls.type.value === 'child'">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">Child
                          is age 2-12.</small>
                        <small class="error_field" *ngIf="traveler.controls.type.value === 'infant'">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error" class="error_img">Infant
                          is age  0-2.</small>
                      </div>
                    </div>
                    <div class="col-sm-12 col-md-4 mb-sm-10 mandetory_wrps"
                      *ngIf="travelerItem.value?.adults[x].hasOwnProperty('passport_number')">
                      <label for="">Passport number*</label>
                      <input type="text" class="form-control" formControlName="passport_number" tabindex={{x}}>
                      <div *ngIf="traveler.controls.passport_number.touched && traveler.controls.passport_number.errors"
                        class="error">
                        <small *ngIf="traveler.controls.passport_number.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error"
                            class="error_img">Enter Passport number.</small>
                      </div>
                    </div>
                    <div class="col-sm-12 col-md-4 mb-sm-10 mandetory_wrps"
                      *ngIf="travelerItem.value?.adults[x].hasOwnProperty('passport_expiry')">
                      <label for="">Expiration*</label>
                      <input type="text" class="form-control" bsDatepicker formControlName="passport_expiry"
                        tabindex={{x}} [bsConfig]="bsConfig" [minDate]="passPortMinDate">
                      <div *ngIf="traveler.controls.passport_expiry.touched && traveler.controls.passport_expiry.errors"
                        class="error">
                        <small *ngIf="traveler.controls.passport_expiry.errors.required" class="error_field">
                          <img src="{{s3BucketUrl}}assets/images/icon/alert_tr.svg" alt="Error"
                            class="error_img">Enter Passport expiration date.</small>
                      </div>
                    </div>


                    <div class="col-sm-12 col-md-4 nation_wrps mandetory_wrps">
                      <label for="">Country of Issue*</label>
                      <ng-select [clearable]="false" [items]="countries" bindLabel="name" bindValue="id" tabindex="10"
                        formControlName="country_id">
                      </ng-select>
                    </div>
                  </div>
                </div>

                <div id="accordion_add" class="accordion_addn">
                  <div class="card">
                    <div class="card-header">
                      <span class="heade_wrps">
                        Add-Ons
                        <a data-toggle="collapse" data-parent="#accordion_add" href="#add_acord"
                          class="addon_anchor responsive_anch" aria-controls="add_acord">
                        </a>
                      </span>
                      <ul class="nav nav-pills" id="addon_tab" role="tablist">
                        <li class="nav-item " role="presentation">
                          <a class="nav-link active" id="baggage-tab" data-toggle="tab" href="#baggage" role="tab"
                            aria-controls="baggage" aria-selected="true">Baggage <br>Included</a>
                        </li>
                        <li class="nav-item disabled_addon" role="presentation">
                          <a class="nav-link" id="boarding-tab" data-toggle="tab" href="#boarding" role="tab"
                            aria-controls="boarding" aria-selected="false">Priority <br>Boarding</a>
                        </li>
                        <li class="nav-item disabled_addon" role="presentation">
                          <a class="nav-link" id="insurance-tab" data-toggle="tab" href="#insurance" role="tab"
                            aria-controls="insurance" aria-selected="false">Insurance</a>
                        </li>

                      </ul>
                      <a data-toggle="collapse" href="#add_acord" class="addon_anchor">
                      </a>
                    </div>
                    <div id="add_acord" class="collapse show">
                      <div class="card-body">
                        <div class="tab-content" id="addon_tabContent">
                          <div class="tab-pane fade show active" id="baggage" role="tabpanel"
                            aria-labelledby="baggage-tab">
                            <div class="addon_listins_wrps">
                              <button class="addon_btn_drop" (click)="$event.preventDefault()">
                                <!-- {{baggageDescription}} -->
                                Some baggage may be included, provider rules apply.
                              </button>
                            </div>
                          </div>
                          <div class="tab-pane fade" id="boarding" role="tabpanel" aria-labelledby="boarding-tab">
                          </div>
                          <div class="tab-pane fade" id="insurance" role="tabpanel" aria-labelledby="insurance-tab">
                            .bbbb
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <span class="edit_btns duel_buttons">
                  <!-- <span class="remove_wrps">
                    <button class="hover-link" [ngClass]="{'disabled': !travelerItem.value.adults[x].userId }"
                      (click)="deleteTraveler(cartNumber,x)">Delete</button>
                  </span> -->
                  <span class="remove_wrps">
                    <button class="hover-link" (click)="deleteTraveler(cartNumber,x)">Delete</button>
                  </span>
                  <button (click)="editTraveler(cartNumber,x)" class="hover-link"
                    [ngClass]="{'disabled': !travelerItem.value.adults[x].userId }">Edit</button>
                  <button (click)="saveTraveler(cartNumber,x)" class="hover-link"
                    [ngClass]="{'disabled': travelerItem.value.adults[x].userId }">Save</button>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</form>